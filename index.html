<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Story Point Estimator</title>
  <style>
    :root {
      --bg-light: #f6f9fc;
      --bg-dark: #1f1f1f;
      --text-light: #333;
      --text-dark: #f1f1f1;
      --box-light: #e7f4ff;
      --box-dark: #2c2c2c;
      --border-light: #ccc;
      --border-dark: #444;
    }

    * {
      transition: background-color 0.5s, color 0.5s, border-color 0.5s;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    h1 {
      text-align: center;
    }

    .floating-counter {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: #007bff;
      color: #fff;
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(20px);
      transition: all 1s ease;
      z-index: 999;
    }

    body.dark .floating-counter {
      background-color: #0056b3;
    }

    .floating-counter.show {
      opacity: 1;
      transform: translateY(0);
    }

    #helpBox {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out, padding 0.3s ease-in-out;
      background-color: #e3f7fc;
      border-left: 5px solid #17a2b8;
      border-radius: 5px;
      padding: 0 15px;
      margin-top: 10px;
    }

    body.dark #helpBox {
      background-color: #1c3f50;
      color: #d0e7f4;
    }

    .toggle-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 32px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 24px;
      width: 24px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #007bff;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .toggle-label {
      margin-left: 12px;
      font-weight: bold;
    }

    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: bold;
    }

    select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid var(--border-light);
    }

    body.dark select, body.dark button {
      background-color: #333;
      color: var(--text-dark);
      border: 1px solid var(--border-dark);
    }

    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }

    button:hover {
      background-color: #0056b3;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: var(--box-light);
      border-left: 6px solid #007bff;
      border-radius: 5px;
    }

    body.dark .result {
      background: var(--box-dark);
    }

    .toggle {
      cursor: pointer;
      color: #007BFF;
      margin-top: 10px;
      display: block;
      text-align: center;
      text-decoration: underline;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      display: none;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid var(--border-light);
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #007bff;
      color: white;
    }

    td {
      background-color: #fff;
    }

    body.dark td {
      background-color: #333;
      color: var(--text-dark);
    }

    body.dark th {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>
    üìä Story Point Estimator
    <span class="info-icon" onclick="toggleHelp()" title="How to use this app">‚ÑπÔ∏è</span>
  </h1>

  <div id="helpBox">
    <strong>üõ† How to Use:</strong>
    <ul>
      <li>Select the <strong>Effort</strong> level based on size/scope of the work.</li>
      <li>Choose <strong>Difficulty</strong> based on technical complexity.</li>
      <li>Specify <strong>Dependencies</strong> or uncertainty in delivery.</li>
      <li>Click <strong>Estimate</strong> to get the suggested Story Point.</li>
      <li>Use the toggle to switch <strong>Light/Dark Mode</strong>.</li>
      <li>View the <strong>Metrics Table</strong> to understand point logic.</li>
    </ul>
    <p style="margin-top:10px;">
      üìò Want a deeper dive?
      <a href="https://medium.com/@AImpact/effort-vs-difficulty-vs-dependencies-the-secret-to-smarter-story-pointing-in-agile-teams-fa1c06b7c520"
         target="_blank" 
         style="color:#007BFF; text-decoration: underline;">
        Read the full blog here.
      </a>
    </p>
    <p>
      üì© <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7197337772737667072" target="_blank" style="color:#007BFF">Subscribe to my newsletter on LinkedIn ‚Äì TPM Trends & AI</a>
    </p>
  </div>

  <div class="toggle-container">
    <label class="switch">
      <input type="checkbox" id="themeToggle" onchange="toggleDarkMode()">
      <span class="slider"></span>
    </label>
    <span class="toggle-label" id="modeLabel">üåô Dark Mode</span>
  </div>

  <label for="effort">‚öôÔ∏è Effort:</label>
  <select id="effort">
    <option value="">-- Select --</option>
    <option value="Tiny">Tiny</option>
    <option value="Small">Small</option>
    <option value="Moderate">Moderate</option>
    <option value="Medium">Medium</option>
    <option value="High">High</option>
    <option value="Extreme">Extreme</option>
  </select>

  <label for="difficulty">üß† Difficulty:</label>
  <select id="difficulty">
    <option value="">-- Select --</option>
    <option value="Easy">Easy</option>
    <option value="Simple">Simple</option>
    <option value="Challenging">Challenging</option>
    <option value="Complex">Complex</option>
    <option value="Hard">Hard</option>
  </select>

  <label for="dependencies">üîó Uncertainty/Dependencies:</label>
  <select id="dependencies">
    <option value="">-- Select --</option>
    <option value="None">None</option>
    <option value="Minimal">Minimal</option>
    <option value="Few">Few</option>
    <option value="Some">Some</option>
    <option value="Many">Many</option>
    <option value="Heavy">Heavy</option>
  </select>

  <button onclick="estimateStoryPoint()">üöÄ Estimate</button>
  <button style="background:#6c757d;" onclick="resetForm()">üîÑ Reset</button>

  <div class="result" id="output"></div>

  <span class="toggle" onclick="toggleTable()">üìã Show/Hide Metrics Table</span>

  <table id="metrics">
    <thead>
      <tr>
        <th>Story Point</th>
        <th>Effort</th>
        <th>Difficulty</th>
        <th>Uncertainty/Dependencies</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>Tiny</td><td>Easy</td><td>None</td></tr>
      <tr><td>2</td><td>Small</td><td>Simple</td><td>Minimal</td></tr>
      <tr><td>3</td><td>Moderate</td><td>Simple</td><td>Few</td></tr>
      <tr><td>5</td><td>Medium</td><td>Challenging</td><td>Some</td></tr>
      <tr><td>8</td><td>High</td><td>Complex</td><td>Many</td></tr>
      <tr><td>13</td><td>Extreme</td><td>Hard</td><td>Heavy</td></tr>
    </tbody>
  </table>

  <div class="floating-counter" id="usageCounter">üßÆ Used by 0 teams</div>

  <script>
    const scores = {
      Effort: { Tiny: 1, Small: 2, Moderate: 3, Medium: 4, High: 5, Extreme: 6 },
      Difficulty: { Easy: 1, Simple: 2, Challenging: 3, Complex: 4, Hard: 5 },
      Dependencies: { None: 1, Minimal: 2, Few: 3, Some: 4, Many: 5, Heavy: 6 }
    };

    function estimateStoryPoint() {
      const effort = document.getElementById('effort').value;
      const difficulty = document.getElementById('difficulty').value;
      const dependencies = document.getElementById('dependencies').value;
      const output = document.getElementById('output');

      if (!effort || !difficulty || !dependencies) {
        output.innerHTML = `<span style='color:red;'>‚ö†Ô∏è Please make all selections.</span>`;
        return;
      }

      const score = scores.Effort[effort] + scores.Difficulty[difficulty] + scores.Dependencies[dependencies];
      let point;

      if (score <= 4) point = 1;
      else if (score <= 6) point = 2;
      else if (score <= 8) point = 3;
      else if (score <= 10) point = 5;
      else if (score <= 12) point = 8;
      else point = 13;

      output.innerHTML = `<strong>‚úÖ Estimated Story Point:</strong> ${point}<br><br>
      <strong>üîç Your selections:</strong><br>
      Effort: ${effort}<br>
      Difficulty: ${difficulty}<br>
      Uncertainty/Dependencies: ${dependencies}`;
    }

    function resetForm() {
      document.getElementById('effort').value = "";
      document.getElementById('difficulty').value = "";
      document.getElementById('dependencies').value = "";
      document.getElementById('output').innerHTML = "";
    }

    function toggleTable() {
      const table = document.getElementById('metrics');
      table.style.display = table.style.display === 'none' ? 'table' : 'none';
    }

    function toggleHelp() {
      const help = document.getElementById('helpBox');
      const isExpanded = help.style.maxHeight && help.style.maxHeight !== '0px';
      if (isExpanded) {
        help.style.maxHeight = '0';
        help.style.paddingTop = '0';
        help.style.paddingBottom = '0';
      } else {
        help.style.maxHeight = help.scrollHeight + 'px';
        help.style.paddingTop = '15px';
        help.style.paddingBottom = '15px';
      }
    }

    function toggleDarkMode() {
      const body = document.body;
      const checkbox = document.getElementById('themeToggle');
      const modeLabel = document.getElementById('modeLabel');

      body.classList.toggle('dark', checkbox.checked);
      modeLabel.textContent = checkbox.checked ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    }

    async function updateUsageCounter() {
      const BIN_ID = "689fa38ed0ea881f405a2fac";
      const API_KEY = "$2a$10$Fon0lgj216IxzegLVp600eIutsY1a0B0Eh2qZjK4pAt9aYXCLi6cu";

      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
          headers: { 'X-Master-Key': API_KEY }
        });

        const data = await res.json();
        const count = (data?.record?.count ?? 0) + 1;

        const counter = document.getElementById('usageCounter');
        counter.textContent = `üßÆ Used by ${count.toLocaleString()} teams`;
        counter.classList.add('show');

        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': API_KEY
          },
          body: JSON.stringify({ count })
        });
      } catch (e) {
        console.error('Usage counter error:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateUsageCounter();
    });
  </script>
</body>
</html>
